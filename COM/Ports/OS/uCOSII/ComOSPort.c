/*
************************************************************************************************************************************
*                      Port/OS/environment related  files for COM communication module.
************************************************************************************************************************************
*          +-----------------------------------------------------------+
*          |                     COM  OS port for uCOSII(>=v2.86)      |
*          +-----------------------------+---------------+-------------+

*filename     : ComOSPort.c  (where x can be 1 to 10)
*brief        :Create a semaphore for every used channel( create,post,pend) if worked in OS system.
*             :This file can be used as a template Ports file for COM service.
*programmer(s): ZG
*version      : V1.70 beta
*date         : 2014-09-04
************************************************************************************************************************************
*/

#include "ComCfg.h"

#if (COM_CFG_BLOCKING_USE_OS == 2)              /* use COM module in uCOSII(>=v2.86)  environment                                 */

#include"includes.h"                            /* for OS signal pend & post service in blocking mode                             */
#include"ComType.h"

/*
************************************************************************************************************************************
*                                  LOCAL VARIABLE  DEFINE
************************************************************************************************************************************
*/

/*
************************************************************************************************************************************
*                                  LOCAL FUNCTIONS  DECLARE
************************************************************************************************************************************
*/

/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE PORT
*                COM1
************************************************************************************************************************************
************************************************************************************************************************************
*/
#if USE_COM1

/* not implemented now    */                        /*Source access the COM1 for multi-thread access safety                       */ 
static  OS_EVENT *  Com1SemRxTerminate;             /* Event for Com..Task                                                        */

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com1OSPortInit(void)
{
    Com1SemRxTerminate = OSSemCreate(0);  
}
/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com1RxTerminateSignal(void) 
{
    OSSemPost(Com1SemRxTerminate);
}
/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com1WaitRxTerminate(void) 
{
    INT8U err; 
    OSSemPend(Com1SemRxTerminate,0,&err);
}                
#endif

/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE PORT
*                COM2
************************************************************************************************************************************
************************************************************************************************************************************
*/

#if USE_COM2

/* not implemented now    */                        /*Source access the COM2 for multi-thread access safety                       */           
static  OS_EVENT *  Com2SemRxTerminate;             /* Event for Com..Task                                                        */

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com2OSPortInit(void)
{
    Com2SemRxTerminate = OSSemCreate(0);
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com2RxTerminateSignal(void) 
{
    OSSemPost(Com2SemRxTerminate);
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com2WaitRxTerminate(void) 
{
    INT8U err; 
    OSSemPend(Com2SemRxTerminate,0,&err);
}
#endif

/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE PORT
*                COM3
************************************************************************************************************************************
************************************************************************************************************************************
*/

#if USE_COM3

/* not implemented now    */                        /*Source access the COM3 for multi-thread access safety                       */ 
static  OS_EVENT *  Com3SemRxTerminate;             /* Event for Com..Task                                                        */

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com3OSPortInit(void)
{
    Com3SemRxTerminate = OSSemCreate(0);                                         
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com3RxTerminateSignal(void) 
{
    OSSemPost(Com3SemRxTerminate);
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com3WaitRxTerminate(void) 
{
    INT8U err; 
    OSSemPend(Com3SemRxTerminate,0,&err);
}
#endif


/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE PORT
*                COM4
************************************************************************************************************************************
************************************************************************************************************************************
*/

#if USE_COM4

/* not implemented now    */                        /*Source access the COM4 for multi-thread access safety                       */ 
static  OS_EVENT *  Com4SemRxTerminate;             /* Event for Com..Task                                                        */

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com4OSPortInit(void)
{
    Com4SemRxTerminate = OSSemCreate(0);                                         
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com4RxTerminateSignal(void) 
{
    OSSemPost(Com4SemRxTerminate);
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com4WaitRxTerminate(void) 
{
    INT8U err; 
    OSSemPend(Com4SemRxTerminate,0,&err);
}
#endif

/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE PORT
*                COM5
************************************************************************************************************************************
************************************************************************************************************************************
*/

#if USE_COM5

/* not implemented now    */                        /*Source access the COM5 for multi-thread access safety                       */ 
static  OS_EVENT *  Com5SemRxTerminate;             /* Event for Com..Task                                                        */

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com5OSPortInit(void)
{
    Com5SemRxTerminate = OSSemCreate(0);                                         
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com5RxTerminateSignal(void) 
{
    OSSemPost(Com5SemRxTerminate);
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com5WaitRxTerminate(void) 
{
    INT8U err; 
    OSSemPend(Com5SemRxTerminate,0,&err);
}
#endif

/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE PORT
*                COM6
************************************************************************************************************************************
************************************************************************************************************************************
*/

#if USE_COM6

/* not implemented now    */                        /*Source access the COM6 for multi-thread access safety                       */ 
static  OS_EVENT *  Com6SemRxTerminate;             /* Event for Com..Task                                                        */

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com6OSPortInit(void)
{
    Com6SemRxTerminate = OSSemCreate(0);                                         
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com6RxTerminateSignal(void) 
{
    OSSemPost(Com6SemRxTerminate);
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com6WaitRxTerminate(void) 
{
    INT8U err; 
    OSSemPend(Com6SemRxTerminate,0,&err);
}
#endif

/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE PORT
*                COM7
************************************************************************************************************************************
************************************************************************************************************************************
*/

#if USE_COM7

/* not implemented now    */                        /*Source access the COM7 for multi-thread access safety                       */ 
static  OS_EVENT *  Com7SemRxTerminate;             /* Event for Com..Task                                                        */

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com7OSPortInit(void)
{
    Com7SemRxTerminate = OSSemCreate(0);                                         
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com7RxTerminateSignal(void) 
{
    OSSemPost(Com7SemRxTerminate);
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com7WaitRxTerminate(void) 
{
    INT8U err; 
    OSSemPend(Com7SemRxTerminate,0,&err);
}
#endif

/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE PORT
*                COM8
************************************************************************************************************************************
************************************************************************************************************************************
*/

#if USE_COM8

/* not implemented now    */                        /*Source access the COM8 for multi-thread access safety                       */ 
static  OS_EVENT *  Com8SemRxTerminate;             /* Event for Com..Task                                                        */

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com8OSPortInit(void)
{
    Com8SemRxTerminate = OSSemCreate(0);                                         
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com8RxTerminateSignal(void) 
{
    OSSemPost(Com8SemRxTerminate);
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com8WaitRxTerminate(void) 
{
    INT8U err; 
    OSSemPend(Com8SemRxTerminate,0,&err);
}
#endif

/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE PORT
*                COM9
************************************************************************************************************************************
************************************************************************************************************************************
*/

#if USE_COM9

/* not implemented now    */                        /*Source access the COM9 for multi-thread access safety                       */ 
static  OS_EVENT *  Com9SemRxTerminate;             /* Event for Com..Task                                                        */

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com9OSPortInit(void)
{
    Com9SemRxTerminate = OSSemCreate(0);                                         
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com9RxTerminateSignal(void) 
{
    OSSemPost(Com9SemRxTerminate);
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com9WaitRxTerminate(void) 
{
    INT8U err; 
    OSSemPend(Com9SemRxTerminate,0,&err);
}
#endif

/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE PORT
*                COM10
************************************************************************************************************************************
************************************************************************************************************************************
*/

#if USE_COM10

/* not implemented now    */                        /*Source access the COM10 for multi-thread access safety                       */ 
static  OS_EVENT *  Com10SemRxTerminate;             /* Event for Com..Task                                                        */

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com10OSPortInit(void)
{
    Com10SemRxTerminate = OSSemCreate(0);                                         
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com10RxTerminateSignal(void) 
{
    OSSemPost(Com10SemRxTerminate);
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com10WaitRxTerminate(void) 
{
    INT8U err; 
    OSSemPend(Com10SemRxTerminate,0,&err);
}
#endif
/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE MULTI PORTS
*                COMX,COMY
************************************************************************************************************************************
************************************************************************************************************************************
*/

T32U ComXYWaitRxTerminate(COMn comx,COMn comy,T16U timeout)
{
    OS_EVENT *events[3];
    OS_EVENT *events_rdy[3];
    void     *events_msgs[3];
    T08U     err;

    switch(comx){
#if USE_COM1
    case COM1:
	events[0] = (OS_EVENT *)Com1SemRxTerminate;break;
#endif
#if USE_COM2
    case COM2:
	events[0] = (OS_EVENT *)Com2SemRxTerminate;break;
#endif
#if USE_COM3
    case COM3:
	events[0] = (OS_EVENT *)Com3SemRxTerminate;break;
#endif
#if USE_COM4
    case COM4:
	events[0] = (OS_EVENT *)Com4SemRxTerminate;break;
#endif
#if USE_COM5
    case COM5:
	events[0] = (OS_EVENT *)Com5SemRxTerminate;break;
#endif
#if USE_COM6
    case COM6:
	events[0] = (OS_EVENT *)Com6SemRxTerminate;break;
#endif
#if USE_COM7
    case COM7:
	events[0] = (OS_EVENT *)Com7SemRxTerminate;break;
#endif
#if USE_COM8
    case COM8:
	events[0] = (OS_EVENT *)Com8SemRxTerminate;break;
#endif
#if USE_COM9
    case COM9:
	events[0] = (OS_EVENT *)Com9SemRxTerminate;break;
#endif
#if USE_COM10
    case COM10:
	events[0] = (OS_EVENT *)Com10SemRxTerminate;break;
#endif
    default:events[0] = 0;
    }

    switch(comy){
#if USE_COM1
    case COM1:
	events[1] = (OS_EVENT *)Com1SemRxTerminate;break;
#endif
#if USE_COM2
    case COM2:
	events[1] = (OS_EVENT *)Com2SemRxTerminate;break;
#endif
#if USE_COM3
    case COM3:
	events[1] = (OS_EVENT *)Com3SemRxTerminate;break;
#endif
#if USE_COM4
    case COM4:
	events[1] = (OS_EVENT *)Com4SemRxTerminate;break;
#endif
#if USE_COM5
    case COM5:
	events[1] = (OS_EVENT *)Com5SemRxTerminate;break;
#endif
#if USE_COM6
    case COM6:
	events[1] = (OS_EVENT *)Com6SemRxTerminate;break;
#endif
#if USE_COM7
    case COM7:
	events[1] = (OS_EVENT *)Com7SemRxTerminate;break;
#endif
#if USE_COM8
    case COM8:
	events[1] = (OS_EVENT *)Com8SemRxTerminate;break;
#endif
#if USE_COM9
    case COM9:
	events[1] = (OS_EVENT *)Com9SemRxTerminate;break;
#endif
#if USE_COM10
    case COM10:
	events[1] = (OS_EVENT *)Com10SemRxTerminate;break;
#endif
    default:events[1] = 0;
    }
    events[2] = 0;


    OSEventPendMulti(&events[0],&events_rdy[0],&events_msgs[0],timeout,&err);
    if(err == OS_ERR_NONE){
	if(events_rdy[0] == events[0]){
	    return comx;
	} else {
	    return comy;
	}
    } else if(err == OS_ERR_TIMEOUT){
	return 0xFF;
    } else {
	return 0xAA;
    }
}



/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE PORT
*                COMxx ...more Port?? It's your jobs!
************************************************************************************************************************************
************************************************************************************************************************************
*/

/*
************************************************************************************************************************************
*                                  file end
************************************************************************************************************************************
*/
#endif/* use COM module in uCOSII(>=v2.86)environment */
