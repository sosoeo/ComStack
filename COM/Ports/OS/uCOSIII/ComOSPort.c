/*
************************************************************************************************************************************
*                      Port/OS/environment related  files for COM communication module.
************************************************************************************************************************************
*          +-----------------------------------------------------------+
*          |                     COM  OS port for uCOSIII              |
*          +-----------------------------+---------------+-------------+

*filename     : ComOSPort.c  (where x can be 1 to 10)
*brief        :Create a semaphore for every used channel( create,post,pend) if worked in OS system.
*             :This file can be used as a template Ports file for COM service.
*programmer(s): ZG
*version      : V1.5
*date         : 2013-02-22
************************************************************************************************************************************
*/

#include "ComCfg.h"

#if (COM_CFG_BLOCKING_USE_OS == 1) /* use COM module in uCOSIII environment */

#include"includes.h"                            /* for OS signal pend & post service in blocking mode                 */

/*
************************************************************************************************************************************
*                                  LOCAL VARIABLE  DEFINE
************************************************************************************************************************************
*/

/*
************************************************************************************************************************************
*                                  LOCAL FUNCTIONS  DECLARE
************************************************************************************************************************************
*/

/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE PORT
*                COM1
************************************************************************************************************************************
************************************************************************************************************************************
*/
#if USE_COM1

static  OS_SEM  Com1Sem;                        /*Source access the COM1 for multi-thread access safety                           */ 
static  OS_SEM  Com1SemRxTerminate;             /* Event for Com..Task                                                            */

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com1OSPortInit(void)
{
    OS_ERR err;  
    OSSemCreate(&Com1Sem,"Com1 Access Sem",1,&err);         
    OSSemCreate(&Com1SemRxTerminate,"Com1 Rx over",0,&err);  

}
/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com1RxTerminateSignal(void) 
{
    OS_ERR err; 
    OSSemPost(&Com1SemRxTerminate,OS_OPT_POST_1,&err);
}
/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com1WaitRxTerminate(void) 
{
    CPU_TS ts;
    OS_ERR err; 
    OSSemPend(&Com1SemRxTerminate,0,OS_OPT_PEND_BLOCKING, &ts,&err);
}                
#endif

/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE PORT
*                COM1
************************************************************************************************************************************
************************************************************************************************************************************
*/

#if USE_COM2

static  OS_SEM  Com2Sem;                        /*Source access the COM2 for multi-thread access safety                           */           
static  OS_SEM  Com2SemRxTerminate;             /* Event for Com..Task                                                            */

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com2OSPortInit(void)
{
    OS_ERR err;   
    OSSemCreate(&Com2Sem,"Com2 Access Sem",1,&err);                                       
    OSSemCreate(&Com2SemRxTerminate,"Com2 Rx over",0,&err);
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com2RxTerminateSignal(void) 
{
    OS_ERR err; 
    OSSemPost(&Com2SemRxTerminate,OS_OPT_POST_1,&err);
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com2WaitRxTerminate(void) 
{
    CPU_TS ts;
    OS_ERR err; 
    OSSemPend(&Com2SemRxTerminate,0,OS_OPT_PEND_BLOCKING, &ts,&err);
}
#endif

/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE PORT
*                COM3
************************************************************************************************************************************
************************************************************************************************************************************
*/

#if USE_COM3

static  OS_SEM  Com3Sem;                        /*Source access the COM3 for multi-thread access safety                           */ 
static  OS_SEM  Com3SemRxTerminate;             /* Event for Com..Task                                                            */

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com3OSPortInit(void)
{
    OS_ERR err;    
    OSSemCreate(&Com3Sem,"Com3 Access Sem",1,&err);         
    OSSemCreate(&Com3SemRxTerminate,"Com3 Rx over",0,&err);                                         
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com3RxTerminateSignal(void) 
{
    OS_ERR err; 
    OSSemPost(&Com3SemRxTerminate,OS_OPT_POST_1,&err);
}

/*--------------------------------------------------------------------------------------------------------------------------------*/
void Com3WaitRxTerminate(void) 
{
    CPU_TS ts;
    OS_ERR err; 
    OSSemPend(&Com3SemRxTerminate,0,OS_OPT_PEND_BLOCKING, &ts,&err);
}
#endif

/*
************************************************************************************************************************************
************************************************************************************************************************************
*                RTOS SERVICE PORT
*                COMxx ...more Port?? It's your jobs!
************************************************************************************************************************************
************************************************************************************************************************************
*/

/*
************************************************************************************************************************************
*                                  file end
************************************************************************************************************************************
*/
#endif/* use COM module in uCOSIII environment */
